- step:
    name: preprocess-dataset
    image: python:3.9
    command:
      - cp /valohai/inputs/dataset/* /valohai/outputs/
    inputs:
      - name: dataset
        default: https://valohaidemo.blob.core.windows.net/mnist/mnist.npz

- step:
    name: train-model
    image: tensorflow/tensorflow:2.6.0
    command:
      - echo "moi"
    parameters:
      - name: epochs
        default: 5
        type: integer
      - name: learning_rate
        default: 0.001
        type: float
    inputs:
      - name: dataset
        default: https://valohaidemo.blob.core.windows.net/mnist/preprocessed_mnist.npz

- pipeline:
    name: Three-Trainings Pipeline
    nodes:
      - name: preprocess
        type: execution
        step: preprocess-dataset
      - name: train1
        type: execution
        step: train-model
        override:
          inputs:
            - name: dataset
      - name: train2
        type: execution
        step: train-model
        override:
          inputs:
            - name: dataset
          parameters:
            - name: epochs
              default: 10
              type: integer
            - name: learning_rate
              default: 0.001
              type: float
      - name: train3
        type: execution
        step: train-model
        override:
          inputs:
            - name: dataset
          parameters:
            - name: epochs
              default: 15
              type: integer
            - name: learning_rate
              default: 0.001
              type: float
    edges:
      - [preprocess.output.*.npz, train1.input.dataset]
      - [preprocess.output.*.npz, train2.input.dataset]
      - [preprocess.output.*.npz, train3.input.dataset]
